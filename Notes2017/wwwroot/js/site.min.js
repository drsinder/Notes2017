function oktochatfunc(){$("#myChatMessage").modal("hide");window.open("/Home/Chat/"+document.getElementById("oktochat").innerHTML+"?id2=false")}function sendChatMessage(){chatChannel.trigger("client-append-message",{username:$("#displayname").val(),message:$("#message").val()});var n=new Date;$("#discussion").append("<li><strong>"+htmlEncode($("#displayname").val())+"<\/strong> @ "+n.toLocaleTimeString()+" : <strong>"+htmlEncode($("#message").val())+"<\/strong><\/li>");$("#message").val("").focus()}function htmlEncode(n){return $("<div />").text(n).html()}var username=document.getElementById("notesusername"),pkey=document.getElementById("pusherkey"),membercount=0,pusher=new Pusher(pkey.innerHTML,{authEndpoint:"/Home/PusherAuth",encrypted:!0}),channel=pusher.subscribe("notes-channel"),presence=pusher.subscribe("presence-channel"),privatechannel=pusher.subscribe("private-data-"+username.innerHTML),chatChannel;channel.bind("sys_message_event",function(n){document.getElementById("sysmessage").innerHTML=n.message;$("#mySysMessage").modal("show")});presence.bind("pusher:subscription_succeeded",function(n){n.each(function(n){add_member(n.id,n.info)})});presence.bind("pusher:member_added",function(n){add_member(n.id,n.info)});presence.bind("pusher:member_removed",function(n){remove_member(n.id,n.info)});presence.bind("chat_request_event",function(n){username!=null&&username.innerHTML==n.username&&(document.getElementById("oktochat").innerHTML=n.username,document.getElementById("sysmessagechat").innerHTML=n.message,$("#myChatMessage").modal("show"))});privatechannel.bind("update-time",function(n){var t=document.getElementById("homepagetime");t!=null&&(t.innerHTML=n.message)});chatChannel=pusher.subscribe("private-chat-"+$("#displayname2").val());chatChannel.bind("show_chat_message_event",function(n){$("#discussion").append("<li><strong>"+htmlEncode(n.username)+"<\/strong>: "+htmlEncode(n.message)+"<\/li>")});chatChannel.bind("client-append-message",function(n){var t=new Date;$("#discussion").append("<li><strong>"+htmlEncode(n.username)+"<\/strong> @ "+t.toLocaleTimeString()+" : <strong>"+htmlEncode(n.message)+"<\/strong><\/li>")});$("#chatsendmessage").click(function(){sendChatMessage()});$("#message").keypress(function(n){var t=n.keyCode?n.keyCode:n.which;t=="13"&&sendChatMessage()});